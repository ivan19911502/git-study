---
- name: First server preparation
  hosts: all
  gather_facts: no
  become: no
  # ignore_errors: true
  vars:
    ssh_key_filename: admin_key
    ssh_key_location_path: /home/ivan11/ansible_quickstart
    local_user: ivan11
  tasks:
  - name: generate SSH key "{{ ssh_key_filename }}"
    user:
      name: "{{ local_user }}"
      generate_ssh_key: yes
      ssh_key_type: rsa
      ssh_key_bits: 4096
      ssh_key_file: "{{ ssh_key_location_path }}/{{ ssh_key_filename }}"
      force: no
    delegate_to: localhost
    run_once: yes


  - name: add key to host
    ansible.builtin.command: ssh-copy-id -i /home/ivan11/ansible_quickstart/admin_key.pub ivan22@ivan22-VirtualBox
    delegate_to: localhost
  
  - name: copy file
    ansible.builtin.copy:
      src: /home/ivan11/ansible_quickstart/con.conf
      dest: /etc/ssh/sshd_config.d/con.conf
      owner: ivan22
      group: sudo
      mode: '0664'
    
  
